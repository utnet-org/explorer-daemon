package test

import (
	"crypto/sha256"
	"encoding/hex"
	"explorer-daemon/database"
	"explorer-daemon/model"
	"gorm.io/gorm"
	"testing"
)

func TestInsertChip(t *testing.T) {
	database.ConnectDB()
	serialNumber := "HQDZWITBCJFBF0023"
	pubKey := "4e1BUTgGBfqVWDRe6SHDoCq2m7B77eH76f39gXQ221nRS7GNAVXnbphXKrGJ32h8NpJ742UTo2759vyPzKKpf13a7tB5LA9TormhVLByjw9AS1PUsnpf15W3mXEH3SALiedfT4PrcNEFBQig3PiSeZkqquXL5MSzFZdEszgEfNjnCFS7bC5oSkZCBZNzn26LwgUQP7Z9wZg6zZVo7GP2De1iGR9LLdXt7MkYwt9ytgWZVPTscsUufvCHwPW2X263U7brV5twV9nEZg61iN73JgXU8dhenvP9ngiaM3UEhAE2oPeqrvfUgHGzkUiFKZnQtZiVvseHV8z2cPwjfxHoZZ13n8ZnKEsSANg3mwCizsQjrmkJkuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu"
	p2key := "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"
	seed := serialNumber + pubKey[:5]
	hash := sha256.New()
	hash.Write([]byte(seed))
	hashBytes := hash.Sum(nil)
	hashString := hex.EncodeToString(hashBytes)[:20]

	newUser := model.Chip{
		Model:        gorm.Model{},
		SearchKey:    "UTC" + hashString,
		ChipType:     "1684",
		Power:        10,
		SerialNumber: serialNumber,
		BusId:        "0",
		P2Key:        p2key,
		PubKey:       pubKey,
		Flag:         "1",
	}
	_, _ = newUser.InsertNewChip(database.DB)
}
